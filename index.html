<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marketing Ops Center</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        :root { --apple-bg: #000000; --apple-card: rgba(28, 28, 30, 0.7); --apple-border: rgba(255, 255, 255, 0.08); }
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: var(--apple-bg);
            background-image: radial-gradient(at 0% 0%, rgba(30, 58, 138, 0.12) 0px, transparent 50%), radial-gradient(at 100% 100%, rgba(79, 70, 229, 0.08) 0px, transparent 50%);
            background-attachment: fixed; color: #ffffff; -webkit-font-smoothing: antialiased; overflow-x: hidden;
        }
        .glass { background: var(--apple-card); backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px); border: 1px solid var(--apple-border); }
        
        .task-card { 
            transition: transform 0.2s ease, box-shadow 0.2s ease, opacity 0.3s ease; 
            cursor: grab;
        }
        .task-card:active { cursor: grabbing; }
        .task-card.dragging {
            opacity: 0.5;
            transform: scale(1.02);
            box-shadow: 0 20px 40px rgba(0,0,0,0.4);
            border-color: rgba(255, 255, 255, 0.3);
            z-index: 50;
        }

        .checkbox-custom { width: 26px; height: 26px; border-radius: 50%; border: 2px solid rgba(255, 255, 255, 0.2); display: flex; align-items: center; justify-content: center; transition: all 0.2s ease; cursor: pointer; }
        .checkbox-checked { background: #34c759; border-color: #34c759; box-shadow: 0 0 10px rgba(52, 199, 89, 0.3); }
        .edit-input { background: rgba(255, 255, 255, 0.1); border-radius: 8px; padding: 6px 12px; border: 1px solid rgba(56, 189, 248, 0.3); color: white; width: 100%; outline: none; font-size: 1rem; }
        .active-pill { background: white !important; color: black !important; box-shadow: 0 4px 12px rgba(255, 255, 255, 0.2); }
        #loading-overlay { position: fixed; inset: 0; background: #000; z-index: 100; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: opacity 0.6s ease; }
        
        select { background-color: #1c1c1e; color: white; border: 1px solid rgba(255, 255, 255, 0.1); padding: 8px 16px; border-radius: 12px; appearance: none; cursor: pointer; }
        select option { background-color: #1c1c1e; color: white; }
        
        .edit-select {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.6);
            font-size: 9px;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            padding: 2px 8px;
            border-radius: 6px;
            outline: none;
            width: fit-content;
        }

        #category-modal {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.85);
            z-index: 200;
            display: none;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(15px);
        }

        .cat-list-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            margin-bottom: 8px;
        }

        ::-webkit-scrollbar { width: 0px; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="min-h-screen pb-20">

    <div id="loading-overlay">
        <div class="w-10 h-10 border-2 border-white/10 border-t-white rounded-full animate-spin mb-6"></div>
        <p id="loader-text" class="text-[10px] font-bold tracking-[0.4em] text-white/30 uppercase">Syncing Workspace</p>
        <button id="skip-btn" onclick="hideLoader()" class="hidden mt-8 text-[10px] text-white/20 uppercase tracking-widest border border-white/10 px-4 py-2 rounded-full hover:bg-white/5 transition-all">Skip and Enter</button>
    </div>

    <!-- Manage Categories Modal -->
    <div id="category-modal" class="p-6 overflow-y-auto">
        <div class="glass max-w-md w-full p-8 rounded-[2.5rem] shadow-2xl animate-in fade-in zoom-in duration-300">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-white text-xl font-medium tracking-tight">Categories</h3>
                <button onclick="toggleCategoryModal(false)" class="text-white/20 hover:text-white transition-colors">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>
            
            <div id="modal-category-list" class="max-h-60 overflow-y-auto no-scrollbar mb-8 pr-1"></div>

            <div class="border-t border-white/10 pt-6">
                <p class="text-[9px] uppercase tracking-widest text-white/30 mb-3 font-bold">Add New Category</p>
                <div class="flex gap-2">
                    <input id="new-category-input" type="text" placeholder="Name..." class="flex-1 bg-white/5 border border-white/10 rounded-2xl px-4 py-3 text-white outline-none focus:border-white/30" />
                    <button onclick="handleAddCategory()" class="bg-white text-black px-6 rounded-2xl text-[10px] font-black uppercase tracking-widest hover:bg-zinc-200 transition-all">Create</button>
                </div>
            </div>
        </div>
    </div>

    <div class="max-w-3xl mx-auto px-6 pt-16">
        <header class="mb-14 text-center">
            <div class="inline-flex items-center gap-2 mb-4 px-4 py-1.5 rounded-full bg-white/5 border border-white/10 shadow-sm">
                <i data-lucide="zap" class="w-3.5 h-3.5 text-sky-400"></i>
                <span class="text-[10px] font-bold tracking-[0.25em] uppercase text-white/60">Unified Dashboard v2.3</span>
            </div>
            <h1 class="text-6xl font-light tracking-tight mb-4 bg-gradient-to-b from-white to-white/40 bg-clip-text text-transparent italic text-center"> Roadmap </h1>
            <p id="current-date" class="text-sm text-white/20 font-medium tracking-wide lowercase text-center"></p>
        </header>

        <div class="grid grid-cols-4 gap-4 mb-12">
            <div class="glass p-5 rounded-[2rem] text-center shadow-xl"><p class="text-[9px] uppercase tracking-widest text-white/30 mb-1">Urgent</p><p id="stat-urgent" class="text-2xl font-semibold text-red-500">0</p></div>
            <div class="glass p-5 rounded-[2rem] text-center shadow-xl"><p class="text-[9px] uppercase tracking-widest text-white/30 mb-1">Queue</p><p id="stat-queue" class="text-2xl font-semibold">0</p></div>
            <div class="glass p-5 rounded-[2rem] text-center shadow-xl"><p class="text-[9px] uppercase tracking-widest text-white/30 mb-1">Done</p><p id="stat-completed" class="text-2xl font-semibold text-emerald-400">0</p></div>
            <div class="glass p-5 rounded-[2rem] flex flex-col items-center justify-center shadow-xl"><p class="text-[8px] uppercase tracking-widest text-white/20 mb-1" id="sync-label">Sync</p><div id="sync-indicator" class="w-2 h-2 rounded-full bg-orange-500"></div></div>
        </div>

        <div class="mb-12 px-2">
            <div class="flex justify-between items-end mb-3">
                <span id="progress-text" class="text-[10px] font-black text-white/40 uppercase tracking-widest">0% Team Progress</span>
                <span id="task-count-text" class="text-[10px] font-medium text-white/20 uppercase tracking-widest">0 Items</span>
            </div>
            <div class="bg-white/5 h-[4px] rounded-full overflow-hidden"><div id="progress-bar" class="bg-white h-full transition-all duration-1000 ease-out" style="width: 0%"></div></div>
        </div>

        <div class="flex items-center justify-between gap-4 mb-8">
            <div class="flex items-center gap-2 overflow-hidden">
                <div id="filter-container" class="flex bg-white/5 p-1 rounded-2xl border border-white/5 overflow-x-auto no-scrollbar"></div>
                <button onclick="toggleCategoryModal(true)" class="p-2.5 rounded-xl bg-white/5 border border-white/10 text-white/40 hover:text-sky-400 transition-colors shrink-0 shadow-sm" title="Settings">
                    <i data-lucide="settings" class="w-4 h-4"></i>
                </button>
            </div>
            <button onclick="toggleAddForm()" class="w-12 h-12 flex items-center justify-center rounded-full bg-white text-black hover:scale-110 active:scale-90 shadow-2xl shrink-0"><i data-lucide="plus" class="w-6 h-6"></i></button>
        </div>

        <div id="add-task-form" class="hidden mb-10 glass p-8 rounded-[2.5rem] animate-in fade-in slide-in-from-top-4 duration-500 shadow-2xl">
            <form onsubmit="handleAddTask(event)" class="space-y-6">
                <input id="new-task-input" type="text" placeholder="What needs to be done?" class="w-full bg-transparent text-2xl font-light outline-none border-b border-white/10 pb-4 focus:border-white/40 transition-colors placeholder:text-white/10" />
                <div class="flex flex-wrap gap-4 justify-between items-center">
                    <div class="flex gap-2 items-center bg-white/5 px-4 py-2 rounded-2xl border border-white/5">
                        <span class="text-[10px] uppercase font-bold text-white/30">Category:</span>
                        <select id="new-task-category" class="bg-transparent text-xs text-white outline-none border-none p-0 pr-6"></select>
                    </div>
                    <button type="submit" class="bg-white text-black px-10 py-3 rounded-full text-xs font-black uppercase tracking-widest hover:bg-zinc-200 transition-all">Publish Task</button>
                </div>
            </form>
        </div>

        <div id="task-list" class="space-y-4"></div>

        <div class="mt-20 pt-10 border-t border-white/5 text-center opacity-20 hover:opacity-100 transition-opacity">
            <button onclick="clearAllData()" class="text-[9px] uppercase tracking-[0.4em] font-bold text-red-500/50 hover:text-red-500"> Wipe Shared Database </button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, updateDoc, deleteDoc, doc, onSnapshot, query, serverTimestamp, getDocs, writeBatch } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAO5BjN8LHwaRfmsmCmkuTCtbBjdhj80_8",
            authDomain: "marketing-dashboard-77465.firebaseapp.com",
            projectId: "marketing-dashboard-77465",
            storageBucket: "marketing-dashboard-77465.firebasestorage.app",
            messagingSenderId: "740462399798",
            appId: "1:740462399798:web:50ba6177743f35ae39e397"
        };
        
        const appId = 'zifou-marketing-team-2026';
        let tasks = [];
        let categories = [];
        let currentFilter = "All";
        let editingId = null;
        let isCloud = false;

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Fail-safe Bypass Timer
        const bypassTimer = setTimeout(() => {
            const loaderText = document.getElementById('loader-text');
            if (loaderText) loaderText.innerText = "Sync slow. Check Firestore Rules.";
            const skipBtn = document.getElementById('skip-btn');
            if (skipBtn) skipBtn.classList.remove('hidden');
        }, 5000);

        window.hideLoader = () => {
            clearTimeout(bypassTimer);
            const overlay = document.getElementById('loading-overlay');
            if (overlay) { overlay.style.opacity = '0'; setTimeout(() => overlay.remove(), 600); }
        };

        // INITIALIZATION
        async function initApp() {
            try {
                await signInAnonymously(auth);
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        isCloud = true;
                        // Sync Categories
                        const catsRef = collection(db, 'artifacts', appId, 'public', 'data', 'shared_categories');
                        onSnapshot(query(catsRef), (snapshot) => {
                            categories = snapshot.docs.map(d => ({ id: d.id, name: d.data().name })).sort((a,b) => a.name.localeCompare(b.name));
                            if (categories.length === 0) seedInitialCategories();
                            refreshUI();
                            renderModalCategoryList();
                        });

                        // Sync Tasks
                        const tasksRef = collection(db, 'artifacts', appId, 'public', 'data', 'shared_tasks');
                        onSnapshot(query(tasksRef), (snapshot) => {
                            const rawTasks = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                            tasks = rawTasks.sort((a, b) => (a.position || 0) - (b.position || 0));
                            if (tasks.length === 0 && categories.length > 0) seedInitialTasks();
                            document.getElementById('sync-indicator').className = "w-2 h-2 rounded-full bg-emerald-500 animate-pulse shadow-[0_0_12px_rgba(52,199,89,0.4)]";
                            document.getElementById('sync-label').innerText = "Cloud Sync";
                            refreshUI();
                            hideLoader();
                        }, (err) => { console.error(err); initLocal(); });
                    }
                });
            } catch (e) { initLocal(); }
        }

        async function seedInitialCategories() {
            const defaults = ["Urgent", "Technical", "Creative", "Strategy", "Recurrent"];
            for (const name of defaults) {
                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'shared_categories'), { name });
            }
        }

        async function seedInitialTasks() {
            const initial = [
                { text: "Enable WhatsApp in Meta", category: "Urgent", completed: false },
                { text: "Fix Google tracking", category: "Technical", completed: false },
                { text: "Finalize Real VSL", category: "Creative", completed: false }
            ];
            for (let i = 0; i < initial.length; i++) {
                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'shared_tasks'), { 
                    ...initial[i], position: i, createdAt: serverTimestamp() 
                });
            }
        }

        function initLocal() {
            isCloud = false;
            const saved = localStorage.getItem('local_roadmap_data');
            tasks = saved ? JSON.parse(saved) : [{ id: "1", text: "Offline Mode. Changes stay local.", category: "Recurrent", completed: false }];
            document.getElementById('sync-indicator').className = "w-2 h-2 rounded-full bg-blue-500";
            document.getElementById('sync-label').innerText = "Local Safe";
            refreshUI();
            setTimeout(hideLoader, 500);
        }

        // CATEGORY HANDLERS
        window.toggleCategoryModal = (show) => {
            document.getElementById('category-modal').style.display = show ? 'flex' : 'none';
            if (show) { renderModalCategoryList(); document.getElementById('new-category-input').focus(); }
        };

        window.handleAddCategory = async () => {
            const input = document.getElementById('new-category-input');
            const name = input.value.trim();
            if (!name) return;
            const formattedName = name.charAt(0).toUpperCase() + name.slice(1);
            if (categories.some(c => c.name === formattedName)) return;
            await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'shared_categories'), { name: formattedName });
            input.value = '';
        };

        window.handleDeleteCategory = async (id, name) => {
            if(!confirm(`Delete category "${name}"? Tasks will stay visible.`)) return;
            await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'shared_categories', id));
        };

        function renderModalCategoryList() {
            const container = document.getElementById('modal-category-list');
            if(!container) return;
            container.innerHTML = categories.map(cat => `
                <div class="cat-list-item">
                    <span class="text-sm font-medium text-white/80">${cat.name}</span>
                    <button onclick="handleDeleteCategory('${cat.id}', '${cat.name}')" class="p-2 text-white/20 hover:text-red-500 transition-colors">
                        <i data-lucide="trash-2" class="w-4 h-4"></i>
                    </button>
                </div>
            `).join('');
            lucide.createIcons();
        }

        // TASK HANDLERS
        window.handleAddTask = async (e) => {
            e.preventDefault();
            const input = document.getElementById('new-task-input');
            const category = document.getElementById('new-task-category').value;
            const text = input.value.trim();
            if (!text) return;
            const maxPos = tasks.length > 0 ? Math.max(...tasks.map(t => t.position || 0)) : 0;
            if (isCloud) {
                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'shared_tasks'), {
                    text, category, completed: false, position: maxPos + 1, createdAt: serverTimestamp()
                });
            } else {
                tasks.unshift({ id: String(Date.now()), text, category, completed: false, position: 0 });
                localStorage.setItem('local_roadmap_data', JSON.stringify(tasks));
                refreshUI();
            }
            input.value = '';
            toggleAddForm();
        };

        window.toggleTask = async (id) => {
            const t = tasks.find(x => x.id === id);
            if (isCloud) {
                await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'shared_tasks', id), { completed: !t.completed });
            } else {
                tasks = tasks.map(t => String(t.id) === String(id) ? { ...t, completed: !t.completed } : t);
                localStorage.setItem('local_roadmap_data', JSON.stringify(tasks));
                refreshUI();
            }
        };

        window.deleteTask = async (id) => {
            if (isCloud) {
                await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'shared_tasks', String(id)));
            } else {
                tasks = tasks.filter(t => String(t.id) !== String(id));
                localStorage.setItem('local_roadmap_data', JSON.stringify(tasks));
                refreshUI();
            }
        };

        window.saveEdit = async (id) => {
            const input = document.getElementById(`edit-${id}`);
            const catSelect = document.getElementById(`edit-cat-${id}`);
            if (!input || !input.value.trim() || !catSelect) return;
            const newText = input.value.trim();
            const newCat = catSelect.value;
            if (isCloud) {
                await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'shared_tasks', id), { text: newText, category: newCat });
            } else {
                tasks = tasks.map(t => String(t.id) === String(id) ? { ...t, text: newText, category: newCat } : t);
                localStorage.setItem('local_roadmap_data', JSON.stringify(tasks));
            }
            editingId = null;
            refreshUI();
        };

        window.clearAllData = async () => {
            if(!confirm("Wipe dashboard tasks?")) return;
            if (isCloud) {
                const snapshot = await getDocs(collection(db, 'artifacts', appId, 'public', 'data', 'shared_tasks'));
                const batch = writeBatch(db);
                snapshot.docs.forEach(d => batch.delete(d.ref));
                await batch.commit();
                seedInitialTasks();
            } else {
                localStorage.removeItem('local_roadmap_data');
                initLocal();
            }
        };

        // DRAG AND DROP
        let draggedItemId = null;
        window.handleDragStart = (e) => { draggedItemId = e.currentTarget.dataset.id; e.currentTarget.classList.add('dragging'); };
        window.handleDragEnd = (e) => { e.currentTarget.classList.remove('dragging'); };
        window.handleDragOver = (e) => { e.preventDefault(); };
        window.handleDrop = async (e) => {
            e.preventDefault();
            const targetId = e.currentTarget.dataset.id;
            if (draggedItemId === targetId) return;
            const newTasks = [...tasks];
            const draggedIdx = newTasks.findIndex(t => t.id === draggedItemId);
            const targetIdx = newTasks.findIndex(t => t.id === targetId);
            const [removed] = newTasks.splice(draggedIdx, 1);
            newTasks.splice(targetIdx, 0, removed);
            tasks = newTasks.map((t, idx) => ({ ...t, position: idx }));
            refreshUI();
            if (isCloud) {
                const batch = writeBatch(db);
                tasks.forEach((t, idx) => {
                    batch.update(doc(db, 'artifacts', appId, 'public', 'data', 'shared_tasks', t.id), { position: idx });
                });
                await batch.commit();
            } else {
                localStorage.setItem('local_roadmap_data', JSON.stringify(tasks));
            }
        };

        window.enterEditMode = (id) => { editingId = id; refreshUI(); setTimeout(() => { const i = document.getElementById(`edit-${id}`); i?.focus(); i?.select(); }, 50); };
        window.setFilter = (cat) => { currentFilter = cat; refreshUI(); };
        window.toggleAddForm = () => document.getElementById('add-task-form').classList.toggle('hidden');

        function refreshUI() {
            const container = document.getElementById('task-list');
            const fTasks = tasks.filter(t => currentFilter === "All" || t.category === currentFilter);
            const filterContainer = document.getElementById('filter-container');
            const addTaskSelect = document.getElementById('new-task-category');
            const catNames = categories.map(c => c.name);
            filterContainer.innerHTML = ["All", ...catNames].map(cat => `<button onclick="setFilter('${cat}')" class="px-5 py-2 rounded-xl text-[10px] font-bold tracking-widest transition-all ${currentFilter === cat ? "active-pill" : "text-white/30 hover:text-white"} uppercase shrink-0">${cat}</button>`).join('');
            if (addTaskSelect) addTaskSelect.innerHTML = catNames.map(cat => `<option value="${cat}">${cat}</option>`).join('');

            if (fTasks.length === 0) {
                container.innerHTML = `<div class="text-center py-20 opacity-10 text-[10px] tracking-[0.5em] uppercase font-black">Empty Roadmap</div>`;
            } else {
                container.innerHTML = fTasks.map(task => {
                    const colors = { 'Urgent': 'text-red-500', 'Technical': 'text-purple-400', 'Creative': 'text-emerald-400', 'Strategy': 'text-sky-400', 'Recurrent': 'text-pink-400' };
                    const isEditing = editingId === task.id;
                    return `
                        <div class="task-card glass flex items-center gap-5 p-6 rounded-[2rem] ${task.completed ? "opacity-30 saturate-0" : ""}" 
                             draggable="true" ondragstart="handleDragStart(event)" ondragover="handleDragOver(event)" ondrop="handleDrop(event)" ondragend="handleDragEnd(event)"
                             data-id="${task.id}">
                            <button onclick="toggleTask('${task.id}')" class="checkbox-custom ${task.completed ? "checkbox-checked" : ""}">
                                ${task.completed ? '<i data-lucide="check" class="w-3 h-3 text-black stroke-[4px]"></i>' : ''}
                            </button>
                            <div class="flex-1 min-w-0">
                                ${isEditing ? `
                                    <div class="flex flex-col gap-2 w-full">
                                        <select id="edit-cat-${task.id}" class="edit-select">${catNames.map(c => `<option value="${c}" ${c === task.category ? 'selected' : ''}>${c}</option>`).join('')}</select>
                                        <input id="edit-${task.id}" type="text" value="${task.text}" onkeydown="if(event.key==='Enter') saveEdit('${task.id}')" class="edit-input" />
                                        <div class="flex gap-2 mt-1">
                                            <button onclick="saveEdit('${task.id}')" class="text-[9px] font-bold text-sky-400 uppercase tracking-widest">Save</button>
                                            <button onclick="editingId=null;refreshUI();" class="text-[9px] font-bold text-white/20 uppercase tracking-widest">Cancel</button>
                                        </div>
                                    </div>
                                ` : `
                                    <span class="text-[9px] font-black uppercase tracking-[0.3em] ${colors[task.category] || 'text-white/40'} block mb-1">${task.category}</span>
                                    <p onclick="enterEditMode('${task.id}')" class="text-base font-medium truncate cursor-pointer transition-colors hover:text-white">${task.text}</p>
                                `}
                            </div>
                            <button onclick="deleteTask('${task.id}')" class="opacity-30 hover:opacity-100 p-2 text-white hover:text-red-500 transition-all"><i data-lucide="x" class="w-5 h-5"></i></button>
                        </div>
                    `;
                }).join('');
            }
            lucide.createIcons();
            const total = tasks.length, done = tasks.filter(t => t.completed).length;
            const progress = total > 0 ? Math.round((done/total)*100) : 0;
            const pBar = document.getElementById('progress-bar');
            if (pBar) pBar.style.width = `${progress}%`;
            const pText = document.getElementById('progress-text');
            if (pText) pText.innerText = `${progress}% Team Progress`;
            const tCount = document.getElementById('task-count-text');
            if (tCount) tCount.innerText = `${done}/${total} Items`;
            const sUrgent = document.getElementById('stat-urgent');
            if (sUrgent) sUrgent.innerText = tasks.filter(t => t.category === "Urgent" && !t.completed).length;
            const sQueue = document.getElementById('stat-queue');
            if (sQueue) sQueue.innerText = tasks.filter(t => !t.completed).length;
            const sCompleted = document.getElementById('stat-completed');
            if (sCompleted) sCompleted.innerText = done;
        }

        document.getElementById('current-date').innerText = new Intl.DateTimeFormat('en-US', { weekday: 'long', month: 'short', day: 'numeric', year: 'numeric' }).format(new Date());
        initApp();
    </script>
</body>
</html>
